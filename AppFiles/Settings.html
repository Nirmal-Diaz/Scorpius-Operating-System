<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" style="height:100%;width:100%;padding:0;overflow: hidden;">

<head>
    <title id="title">Settings</title>
    <meta charset="UTF-8">

    <base href="../">

    <link rel="stylesheet" href="AppFiles/AppStyleSheets/SerketAppPlatform_StyleVariables.css">
    <link rel="stylesheet" href="AppFiles/AppStyleSheets/SerketAppPlatform_Styles.css">

    <script src="AppFiles/AppScripts/SerketAppPlatform_FunctionsLibrary.js"></script>

    <style>
        .panelAreaDivisionSector {
            width: 100%;
        }

        .panelAreaDivisionSector > input, .panelAreaDivisionSector:hover > input {
            border-bottom: thin var(--panelSectorBorder_hoverChild);
        }

        .panelAreaDivisionSector-active > input {
            border-bottom: thin var(--panelSectorBorder_activeChild);
        }

        .panelAreaDivisionSector-active > input {
            color: var(--panelSectorColor_hoverChild) !important;
        }

        .textInput {
            text-align: left;

            border: none;
        }

        .colorSliderContainer {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;

            height: 100px;
            width: 100px;
        }

        .colorSliderThumbContainer {
            display: flex;
            justify-content: center;
            align-items: center;

            height: 100%;
            width: 100%;

            transform: rotate(180deg);
        }

        .colorSliderThumb {
            display: flex;
            justify-content: center;
            align-items: center;

            height: 100%;
            width: 100%;

            border: thick solid rgba(40, 40, 40, 0.8);
            border-bottom-color: rgba(40, 40, 40, 1);
            border-radius: 100%;
        }

        .colorPreview {
            height: 100px;
            width: 100px;

            background-color: rgba(65, 65, 65, 1);
            border: thick solid rgba(40, 40, 40, 1);
            border-radius: 100%;
        }
    </style>

    <script>
        function scanSettingsFile(settingsFilePath, outputPanel) {
            //Remove previous panelSectors
            outputPanel.innerHTML = "";
            //Create sectors for variables
            parseHttpDataRequest(settingsFilePath, undefined, "json", function (styleVariablesObject) {
                //Create a panelSector for each directory if there are any
                for (let styleVariable in styleVariablesObject) {
                    //panelSector creation
                    var panelSector = document.createElement("div");
                    panelSector.id = styleVariable;
                    //Add stringifiedDataArray for the relevant key inside the panelSector's "data-array" attribute
                    panelSector.dataset.dataArray = JSON.stringify(styleVariablesObject[styleVariable]);
                    panelSector.setAttribute("class", "panelAreaDivisionSector");
                    //Add eventListener for start editing variable
                    panelSector.addEventListener("click", function () { selectSector(this); });
                    //panelSectorTitle creation
                    var panelSectorTitle = document.createElement("h1");
                    panelSectorTitle.setAttribute("class", "title");
                    panelSectorTitle.innerHTML = styleVariablesObject[styleVariable][0];
                    //panelSectorEventType creation
                    var panelSectorEventType = document.createElement("p");
                    panelSectorEventType.setAttribute("class", "information");
                    panelSectorEventType.innerHTML = styleVariablesObject[styleVariable][1];
                    //panelSectorEventType creation
                    var panelSectorVariableValueInput = document.createElement("input");
                    panelSectorVariableValueInput.setAttribute("class", "textInput");
                    panelSectorVariableValueInput.type = "text";
                    panelSectorVariableValueInput.value = styleVariablesObject[styleVariable][2];
                    //Append elements into HTML
                    panelSector.appendChild(panelSectorTitle);
                    panelSector.appendChild(panelSectorEventType);
                    panelSector.appendChild(panelSectorVariableValueInput);
                    outputPanel.appendChild(panelSector);
                }
            });
        }

        function selectSector(sectorToSelect) {
            //Check if any sector is selected
            if (selectedSector != false) {
                //Deselect selectedSector
                selectedSector.classList.remove("panelAreaDivisionSector-active");
                //Remove selectedSector's input id
                selectedSector.children[2].id = "";
            }
            //Check if there is any sectorToSelect
            if (sectorToSelect != false) {
                //Select sectorToSelect
                sectorToSelect.classList.add("panelAreaDivisionSector-active");
                //Make the selectedSector's input into synchronizableInputSecondary
                sectorToSelect.children[2].id = "synchronizableInputSecondary";
            }
            //Update selectedSector
            selectedSector = sectorToSelect;
        }

        function createStylesheetObject(panelDivision) {
            //Get all panelAreaDivisionSectors
            var panelSectorsArray = panelDivision.children;
            //Compile each panelSector's data into the stylesheetObject
            var panelSectorsArrayLength = panelSectorsArray.length;
            var stylesheetObject = {};
            for (var i = 0; i < panelSectorsArrayLength; i++) {
                //Get the inputValue of the panelSector
                var panelSectorVariableValueInput = panelSectorsArray[i].children[2].value;
                //Retrieve the original dataArray stringified inside data-array attribute
                stylesheetObject[panelSectorsArray[i].id] = JSON.parse(panelSectorsArray[i].dataset.dataArray);
                //Replace its styleVariableValue with the new value
                stylesheetObject[panelSectorsArray[i].id][2] = panelSectorVariableValueInput;
            }
            //Return the stylesheetObject
            return stylesheetObject;
        }

        function createStylesheetContent(stylesheetObject) {
            //Declare and initialize stylesheetContent
            var stylesheetContent = ":root {\n";
            //Convert stylesheetObject's key-value pairs into css variable-value pairs
            for (var cssVariable in stylesheetObject) {
                stylesheetContent = stylesheetContent + cssVariable + ": " + stylesheetObject[cssVariable][2] + ";\n";
            }
            //Add the last line of the stylesheetContent
            stylesheetContent = stylesheetContent + "}";
            //Return the stylesheetContent
            return stylesheetContent;
            
        }

        //WARNING: NOT IMPLEMENTED
        function applySettings() {
            //Get stylesheetObject for the shell
            var shellStylesheetObject = createStylesheetObject(document.getElementById("shellPersonalizationPanel"));
            //Update every cssVariable in the :root rule with the corresponding inputValue
            for (var cssVariable in shellStylesheetObject) {
                window.parent.document.styleSheets[0].cssRules[0].style.setProperty(cssVariable, shellStylesheetObject[cssVariable][2]);
            }
            //Get stylesheetObject for the app styles
            var appStylesheetObject = createStylesheetObject(document.getElementById("appPersonalizationPanel"));
            //Update every cssVariable in the :root rule with the corresponding inputValue
            for (var cssVariable in appStylesheetObject) {
                document.styleSheets[0].cssRules[0].style.setProperty(cssVariable, appStylesheetObject[cssVariable][2]);
            }
        }

        function saveSettings() {
            //Save settings for the shell
            var shellStylesheetObject = createStylesheetObject(document.getElementById("shellPersonalizationPanel"));
            var shellStylesheetContent = createStylesheetContent(shellStylesheetObject);
            writeToFiles(shellStylesheetObject, shellStylesheetContent, "System64/ShellStyleSheets/Shell_StyleVariables");
            //Save settings for the apps
            var appStylesheetObject = createStylesheetObject(document.getElementById("appPersonalizationPanel"));
            var appStylesheetContent = createStylesheetContent(appStylesheetObject);
            writeToFiles(appStylesheetObject, appStylesheetContent, "AppFiles/AppStyleSheets/SerketAppPlatform_StyleVariables");
        }

        function writeToFiles(stylesheetObject, stylesheetContent, commonFileName) {
            //Save content to the .json file
            //Objectify PHP parameters
            var parametersObjectJSON = {
                functionString: "saveTextToFile();",
                filePath: commonFileName + ".json",
                contentString: JSON.stringify(stylesheetObject)
            };
            //Send data to the server for saving
            parseHttpTaskRequest('FileSystem.php', parametersObjectJSON, undefined);
            //Save content to th .css file
            //Objectify PHP parameters
            var parametersObjectCSS = {
                functionString: "saveTextToFile();",
                filePath: commonFileName + ".css",
                contentString: stylesheetContent
            };
            //Send data to the server for saving
            parseHttpTaskRequest('FileSystem.php', parametersObjectCSS, undefined);
        }

        function initialize() {
            //Declare and initialize variables
            selectedSector = false;
            //Make sectors for each variable inside the relevant panel
            scanSettingsFile("System64/ShellStyleSheets/Shell_StyleVariables.json", document.getElementById("shellPersonalizationPanel"));
            scanSettingsFile("AppFiles/AppStyleSheets/SerketAppPlatform_StyleVariables.json", document.getElementById("appPersonalizationPanel"));
        }
    </script>
</head>

<body id="body" class="body" onload="initialize();">
    <!-- sidebarArea -->
    <div id="sidebarArea" class="sidebarArea">
        <div class="sidebarAreaDivision sidebarAreaDivision-active" onclick="switchPane('panelsPane', this);"><span
                class="label">PANELS</span></div>
        <div class="sidebarAreaDivision" onclick="switchPane('homePane', this);"><span class="label">HOME</span></div>
        <div class="sidebarAreaDivision" onclick="switchPane('settingsPane', this);"><span class="label">SETTINGS</span></div>
    </div>
    <!-- paneArea -->
    <div id="paneArea" class="paneArea">
        <div id="panelsPane" class="paneAreaDivision">
            <div class="paneAreaDivisionSector paneAreaDivisionSector-active" onclick="switchPanel('themesPanel', this);">
                <h1 class="title">Themes Library</h1>
                <p class="definition">Navigate through the pre-defined themes</p>
            </div>
            <div class="paneAreaDivisionSector" onclick="switchPanel('shellPersonalizationPanel', this);">
                <h1 class="title">Shell Personalization</h1>
                <p class="definition">Tweak the variables that make up the shell of Scorpius</p>
            </div>
            <div class="paneAreaDivisionSector" onclick="switchPanel('appPersonalizationPanel', this);">
                <h1 class="title">Serket Platform Styles</h1>
                <p class="definition">Tweak the variables that affects all the apps based on the Serket App Platform</p>
            </div>
        </div>

        <div id="homePane" class="paneAreaDivision">
            <div class="paneAreaDivisionSector">
                <h1 class="title">Apply Settings</h1>
                <p class="definition">Apply and review the tweaks</p>
                <button class="button" onclick=""><span class="label">APPLY</span></button>
            </div>
        </div>

        <div id="settingsPane" class="paneAreaDivision">

        </div>

    </div>
    <!-- panelArea -->
    <div id="panelArea" class="panelArea">
        <div id="themesPanel" class="panelAreaDivision">

        </div>
        <div id="shellPersonalizationPanel" class="panelAreaDivision">

        </div>
        <div id="appPersonalizationPanel" class="panelAreaDivision">

        </div>
    </div>
    <!-- infoArea -->
    <div id="infoArea" class="infoArea">
        <div class="infoAreaDivision"></div>
    </div>
    <!-- controlsArea -->
    <div id="controlsArea" class="controlsArea">

    </div>

    <!-- Content of the quickAccessArea -->
    <div id="quickAccessArea" class="quickAccessArea" style="display: none;">
        <span id="dataCarrier" data-window-index="" data-height="500px" data-width="1250px" data-resizable="false"></span>
        <div class="quickAccessBar">
            <input id="synchronizableInputPrimary" type="text" placeholder="Enter variable value..." onkeyup="parseOuterScript('synchronizeInput');" />
        </div>
        <div class="startButton" onclick="parseInnerScript('applySettings');">
            <span>Apply</span>
        </div>
        <div class="quickAccessBar">
            <span onclick="parseInnerScript('saveSettings');">Save</span>
            <span onclick="parseInnerScript('refreshWindow');">Refresh</span>
            <span onclick="parseOuterScript('closeWindow');">Close</span>
        </div>
    </div>
</body>

</html>